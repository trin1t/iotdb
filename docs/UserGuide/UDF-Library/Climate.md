<!--

​    Licensed to the Apache Software Foundation (ASF) under one
​    or more contributor license agreements.  See the NOTICE file
​    distributed with this work for additional information
​    regarding copyright ownership.  The ASF licenses this file
​    to you under the Apache License, Version 2.0 (the
​    "License"); you may not use this file except in compliance
​    with the License.  You may obtain a copy of the License at
​    
​        http://www.apache.org/licenses/LICENSE-2.0
​    
​    Unless required by applicable law or agreed to in writing,
​    software distributed under the License is distributed on an
​    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
​    KIND, either express or implied.  See the License for the
​    specific language governing permissions and limitations
​    under the License.

-->

# Climate Statistics

## ACC

### Usage

This function is used to calculate the Anomaly Correlation Coefficient (ACC).

**Name:** PEARSON

**Input Series:** Only support three input series. Supported types are INT32 / INT64 / FLOAT / DOUBLE. The first series is the forecast series; the second series is the verifying series; the third series is the reference series.

**Output Series:** Output a single series. The type is DOUBLE. There is only one data point in the series, whose timestamp is the last input timestamp and value is the Anomaly Correlation Coefficient.

**Note:**

+ If a row contains missing points, null points or `NaN`, it will be ignored;
+ If all rows are ignored, `NaN` will be output.


### Examples

Input series:

```
+-----------------------------+----------------+----------------+----------------+
|                         Time|root.weather.for|root.weather.ver|root.weather.ref|
+-----------------------------+----------------+----------------+----------------+
|2013-01-01T00:00:00.000+08:00|             5.0|             4.0|             4.0|
|2013-02-01T00:00:00.000+08:00|             8.0|             6.0|             7.0|
|2013-03-01T00:00:00.000+08:00|             2.0|             1.0|             2.0|
|2013-04-01T00:00:00.000+08:00|             2.0|             5.0|             3.0|
|2013-05-01T00:00:00.000+08:00|            65.0|            63.0|            63.0|
|2013-06-01T00:00:00.000+08:00|            65.0|            63.0|            63.0|
|2013-07-01T00:00:00.000+08:00|            61.0|            60.0|            57.0|
|2013-08-01T00:00:00.000+08:00|            80.0|            23.0|            65.0|
|2013-09-01T00:00:00.000+08:00|           100.0|           105.0|           113.0|
|2013-10-01T00:00:00.000+08:00|            15.0|             3.0|            12.0|
|2013-11-01T00:00:00.000+08:00|             6.0|             4.0|            10.0|
|2013-12-01T00:00:00.000+08:00|            15.0|            15.0|            12.0|
+-----------------------------+----------------+----------------+----------------+
```

SQL for query:

```sql
select acc(for,ver,ref) from root.test.weather
```

Output series:

```
+-----------------------------+---------------------------------------------------------+
|                         Time|acc(root.weather.for, root.weather.ver, root.weather.ref)|
+-----------------------------+---------------------------------------------------------+
|2013-12-01T00:00:00.000+08:00|                                      -0.5196317180485549|
+-----------------------------+---------------------------------------------------------+
```

## Departure

### Usage

This function is used to calculate the departure from average (anomaly) of input series.

**Name:** Departure

**Input Series:** Only support two input series. The types are both INT32 / INT64 / FLOAT / DOUBLE.

**Output Series:** Output a single series. The type is DOUBLE.

**Parameters:**

+ `aggr`: Granularity for calculation. "m" for month, and "d" for day.

### Examples

Input series:

```
+-----------------------------+--------------------------+
|                         Time|root.weather.precipitation|
+-----------------------------+--------------------------+
|2013-01-01T00:00:00.000+08:00|                         4|
|2013-02-01T00:00:00.000+08:00|                         6|
|2013-03-01T00:00:00.000+08:00|                         1|
|2013-04-01T00:00:00.000+08:00|                         5|
|2013-05-01T00:00:00.000+08:00|                        27|
|2013-06-01T00:00:00.000+08:00|                        63|
|2013-07-01T00:00:00.000+08:00|                        60|
|2013-08-01T00:00:00.000+08:00|                        23|
|2013-09-01T00:00:00.000+08:00|                       105|
|2013-10-01T00:00:00.000+08:00|                         3|
|2013-11-01T00:00:00.000+08:00|                         4|
|2013-12-01T00:00:00.000+08:00|                        15|
|2014-01-01T00:00:00.000+08:00|                        10|
|2014-02-01T00:00:00.000+08:00|                        13|
|2014-03-01T00:00:00.000+08:00|                         9|
|2014-04-01T00:00:00.000+08:00|                         9|
|2014-05-01T00:00:00.000+08:00|                        26|
|2014-06-01T00:00:00.000+08:00|                        57|
|2014-07-01T00:00:00.000+08:00|                        64|
|2014-08-01T00:00:00.000+08:00|                        16|
|2014-09-01T00:00:00.000+08:00|                       109|
|2014-10-01T00:00:00.000+08:00|                         3|
|2014-11-01T00:00:00.000+08:00|                        11|
|2014-12-01T00:00:00.000+08:00|                        18|
|2015-01-01T00:00:00.000+08:00|                        13|
|2015-02-01T00:00:00.000+08:00|                         0|
|2015-03-01T00:00:00.000+08:00|                         0|
|2015-04-01T00:00:00.000+08:00|                         9|
|2015-05-01T00:00:00.000+08:00|                        19|
|2015-06-01T00:00:00.000+08:00|                        63|
|2015-07-01T00:00:00.000+08:00|                        65|
|2015-08-01T00:00:00.000+08:00|                        29|
|2015-09-01T00:00:00.000+08:00|                        95|
|2015-10-01T00:00:00.000+08:00|                         0|
|2015-11-01T00:00:00.000+08:00|                         9|
|2015-12-01T00:00:00.000+08:00|                        25|
|2016-01-01T00:00:00.000+08:00|                         0|
|2016-02-01T00:00:00.000+08:00|                         0|
|2016-03-01T00:00:00.000+08:00|                         8|
|2016-04-01T00:00:00.000+08:00|                         9|
|2016-05-01T00:00:00.000+08:00|                        21|
|2016-06-01T00:00:00.000+08:00|                        73|
|2016-07-01T00:00:00.000+08:00|                        53|
|2016-08-01T00:00:00.000+08:00|                        30|
|2016-09-01T00:00:00.000+08:00|                       107|
|2016-10-01T00:00:00.000+08:00|                         0|
|2016-11-01T00:00:00.000+08:00|                        11|
|2016-12-01T00:00:00.000+08:00|                         8|
|2017-01-01T00:00:00.000+08:00|                        13|
|2017-02-01T00:00:00.000+08:00|                         8|
|2017-03-01T00:00:00.000+08:00|                         0|
|2017-04-01T00:00:00.000+08:00|                         9|
|2017-05-01T00:00:00.000+08:00|                        32|
|2017-06-01T00:00:00.000+08:00|                        64|
|2017-07-01T00:00:00.000+08:00|                        52|
|2017-08-01T00:00:00.000+08:00|                        29|
|2017-09-01T00:00:00.000+08:00|                       115|
|2017-10-01T00:00:00.000+08:00|                         3|
|2017-11-01T00:00:00.000+08:00|                         0|
|2017-12-01T00:00:00.000+08:00|                        21|
+-----------------------------+--------------------------+
```

SQL for query:
```sql
select departure(precipitation,'aggr'='m') from root.weather
```

Output series:
```
+-----------------------------+-------------------------------------------------+
|                         Time|departure(root.weather.precipitation, "aggr"="m")|
+-----------------------------+-------------------------------------------------+
|2013-01-01T00:00:00.000+08:00|                                             -4.0|
|2013-02-01T00:00:00.000+08:00|                               0.5999999999999996|
|2013-03-01T00:00:00.000+08:00|                                             -2.6|
|2013-04-01T00:00:00.000+08:00|                              -3.1999999999999993|
|2013-05-01T00:00:00.000+08:00|                                              2.0|
|2013-06-01T00:00:00.000+08:00|                                             -1.0|
|2013-07-01T00:00:00.000+08:00|                               1.2000000000000028|
|2013-08-01T00:00:00.000+08:00|                              -2.3999999999999986|
|2013-09-01T00:00:00.000+08:00|                              -1.2000000000000028|
|2013-10-01T00:00:00.000+08:00|                                              1.2|
|2013-11-01T00:00:00.000+08:00|                                             -3.0|
|2013-12-01T00:00:00.000+08:00|                              -2.3999999999999986|
|2014-01-01T00:00:00.000+08:00|                                              2.0|
|2014-02-01T00:00:00.000+08:00|                                              7.6|
|2014-03-01T00:00:00.000+08:00|                                              5.4|
|2014-04-01T00:00:00.000+08:00|                               0.8000000000000007|
|2014-05-01T00:00:00.000+08:00|                                              1.0|
|2014-06-01T00:00:00.000+08:00|                                             -7.0|
|2014-07-01T00:00:00.000+08:00|                                5.200000000000003|
|2014-08-01T00:00:00.000+08:00|                               -9.399999999999999|
|2014-09-01T00:00:00.000+08:00|                                2.799999999999997|
|2014-10-01T00:00:00.000+08:00|                                              1.2|
|2014-11-01T00:00:00.000+08:00|                                              4.0|
|2014-12-01T00:00:00.000+08:00|                               0.6000000000000014|
|2015-01-01T00:00:00.000+08:00|                                              5.0|
|2015-02-01T00:00:00.000+08:00|                                             -5.4|
|2015-03-01T00:00:00.000+08:00|                                             -3.6|
|2015-04-01T00:00:00.000+08:00|                               0.8000000000000007|
|2015-05-01T00:00:00.000+08:00|                                             -6.0|
|2015-06-01T00:00:00.000+08:00|                                             -1.0|
|2015-07-01T00:00:00.000+08:00|                                6.200000000000003|
|2015-08-01T00:00:00.000+08:00|                               3.6000000000000014|
|2015-09-01T00:00:00.000+08:00|                              -11.200000000000003|
|2015-10-01T00:00:00.000+08:00|                                             -1.8|
|2015-11-01T00:00:00.000+08:00|                                              2.0|
|2015-12-01T00:00:00.000+08:00|                                7.600000000000001|
|2016-01-01T00:00:00.000+08:00|                                             -8.0|
|2016-02-01T00:00:00.000+08:00|                                             -5.4|
|2016-03-01T00:00:00.000+08:00|                                              4.4|
|2016-04-01T00:00:00.000+08:00|                               0.8000000000000007|
|2016-05-01T00:00:00.000+08:00|                                             -4.0|
|2016-06-01T00:00:00.000+08:00|                                              9.0|
|2016-07-01T00:00:00.000+08:00|                               -5.799999999999997|
|2016-08-01T00:00:00.000+08:00|                                4.600000000000001|
|2016-09-01T00:00:00.000+08:00|                               0.7999999999999972|
|2016-10-01T00:00:00.000+08:00|                                             -1.8|
|2016-11-01T00:00:00.000+08:00|                                              4.0|
|2016-12-01T00:00:00.000+08:00|                               -9.399999999999999|
|2017-01-01T00:00:00.000+08:00|                                              5.0|
|2017-02-01T00:00:00.000+08:00|                               2.5999999999999996|
|2017-03-01T00:00:00.000+08:00|                                             -3.6|
|2017-04-01T00:00:00.000+08:00|                               0.8000000000000007|
|2017-05-01T00:00:00.000+08:00|                                              7.0|
|2017-06-01T00:00:00.000+08:00|                                              0.0|
|2017-07-01T00:00:00.000+08:00|                               -6.799999999999997|
|2017-08-01T00:00:00.000+08:00|                               3.6000000000000014|
|2017-09-01T00:00:00.000+08:00|                                8.799999999999997|
|2017-10-01T00:00:00.000+08:00|                                              1.2|
|2017-11-01T00:00:00.000+08:00|                                             -7.0|
|2017-12-01T00:00:00.000+08:00|                               3.6000000000000014|
+-----------------------------+-------------------------------------------------+
```

## HistoryAvg

### Usage

This function is used to calculate the historical average .

**Name:** HistoryAvg

**Input Series:** Only support two input series. The types are both INT32 / INT64 / FLOAT / DOUBLE.

**Output Series:** Output a single series. The type is DOUBLE.

**Parameters:**

+ `aggr`: Granularity for calculation. "m" for month, and "d" for day.

### Examples

Input series:

```
+-----------------------------+--------------------------+
|                         Time|root.weather.precipitation|
+-----------------------------+--------------------------+
|2013-01-01T00:00:00.000+08:00|                         4|
|2013-02-01T00:00:00.000+08:00|                         6|
|2013-03-01T00:00:00.000+08:00|                         1|
|2013-04-01T00:00:00.000+08:00|                         5|
|2013-05-01T00:00:00.000+08:00|                        27|
|2013-06-01T00:00:00.000+08:00|                        63|
|2013-07-01T00:00:00.000+08:00|                        60|
|2013-08-01T00:00:00.000+08:00|                        23|
|2013-09-01T00:00:00.000+08:00|                       105|
|2013-10-01T00:00:00.000+08:00|                         3|
|2013-11-01T00:00:00.000+08:00|                         4|
|2013-12-01T00:00:00.000+08:00|                        15|
|2014-01-01T00:00:00.000+08:00|                        10|
|2014-02-01T00:00:00.000+08:00|                        13|
|2014-03-01T00:00:00.000+08:00|                         9|
|2014-04-01T00:00:00.000+08:00|                         9|
|2014-05-01T00:00:00.000+08:00|                        26|
|2014-06-01T00:00:00.000+08:00|                        57|
|2014-07-01T00:00:00.000+08:00|                        64|
|2014-08-01T00:00:00.000+08:00|                        16|
|2014-09-01T00:00:00.000+08:00|                       109|
|2014-10-01T00:00:00.000+08:00|                         3|
|2014-11-01T00:00:00.000+08:00|                        11|
|2014-12-01T00:00:00.000+08:00|                        18|
|2015-01-01T00:00:00.000+08:00|                        13|
|2015-02-01T00:00:00.000+08:00|                         0|
|2015-03-01T00:00:00.000+08:00|                         0|
|2015-04-01T00:00:00.000+08:00|                         9|
|2015-05-01T00:00:00.000+08:00|                        19|
|2015-06-01T00:00:00.000+08:00|                        63|
|2015-07-01T00:00:00.000+08:00|                        65|
|2015-08-01T00:00:00.000+08:00|                        29|
|2015-09-01T00:00:00.000+08:00|                        95|
|2015-10-01T00:00:00.000+08:00|                         0|
|2015-11-01T00:00:00.000+08:00|                         9|
|2015-12-01T00:00:00.000+08:00|                        25|
|2016-01-01T00:00:00.000+08:00|                         0|
|2016-02-01T00:00:00.000+08:00|                         0|
|2016-03-01T00:00:00.000+08:00|                         8|
|2016-04-01T00:00:00.000+08:00|                         9|
|2016-05-01T00:00:00.000+08:00|                        21|
|2016-06-01T00:00:00.000+08:00|                        73|
|2016-07-01T00:00:00.000+08:00|                        53|
|2016-08-01T00:00:00.000+08:00|                        30|
|2016-09-01T00:00:00.000+08:00|                       107|
|2016-10-01T00:00:00.000+08:00|                         0|
|2016-11-01T00:00:00.000+08:00|                        11|
|2016-12-01T00:00:00.000+08:00|                         8|
|2017-01-01T00:00:00.000+08:00|                        13|
|2017-02-01T00:00:00.000+08:00|                         8|
|2017-03-01T00:00:00.000+08:00|                         0|
|2017-04-01T00:00:00.000+08:00|                         9|
|2017-05-01T00:00:00.000+08:00|                        32|
|2017-06-01T00:00:00.000+08:00|                        64|
|2017-07-01T00:00:00.000+08:00|                        52|
|2017-08-01T00:00:00.000+08:00|                        29|
|2017-09-01T00:00:00.000+08:00|                       115|
|2017-10-01T00:00:00.000+08:00|                         3|
|2017-11-01T00:00:00.000+08:00|                         0|
|2017-12-01T00:00:00.000+08:00|                        21|
+-----------------------------+--------------------------+
```

SQL for query:
```sql
select HistoryAvg(precipitation,'aggr'='m') from root.weather limit 12
```

Output series:
```
+-----------------------------+--------------------------------------------------+
|                         Time|HistoryAvg(root.weather.precipitation, "aggr"="m")|
+-----------------------------+--------------------------------------------------+
|2013-01-01T00:00:00.000+08:00|                                               8.0|
|2013-02-01T00:00:00.000+08:00|                                               5.4|
|2013-03-01T00:00:00.000+08:00|                                               3.6|
|2013-04-01T00:00:00.000+08:00|                                               8.2|
|2013-05-01T00:00:00.000+08:00|                                              25.0|
|2013-06-01T00:00:00.000+08:00|                                              64.0|
|2013-07-01T00:00:00.000+08:00|                                              58.8|
|2013-08-01T00:00:00.000+08:00|                                              25.4|
|2013-09-01T00:00:00.000+08:00|                                             106.2|
|2013-10-01T00:00:00.000+08:00|                                               1.8|
|2013-11-01T00:00:00.000+08:00|                                               7.0|
|2013-12-01T00:00:00.000+08:00|                                              17.4|
+-----------------------------+--------------------------------------------------+
```

## Accumulated Departure

### Usage

This function is used to calculate the accumulation departure from average of input series.

**Name:** AccumulatedDeparture

**Input Series:** Only support one input series. The type is INT32 / INT64 / FLOAT / DOUBLE.

**Output Series:** Output a single series. The type is DOUBLE.

**Parameters:**

+ `aggr`: Granularity for calculation. "m" for month, and "d" for day.

+ `period`: history period for data. For example, 5 means calculate the past 5 years of data.