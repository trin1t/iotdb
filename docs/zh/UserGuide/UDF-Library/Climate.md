<!--

​    Licensed to the Apache Software Foundation (ASF) under one
​    or more contributor license agreements.  See the NOTICE file
​    distributed with this work for additional information
​    regarding copyright ownership.  The ASF licenses this file
​    to you under the Apache License, Version 2.0 (the
​    "License"); you may not use this file except in compliance
​    with the License.  You may obtain a copy of the License at
​    
​        http://www.apache.org/licenses/LICENSE-2.0
​    
​    Unless required by applicable law or agreed to in writing,
​    software distributed under the License is distributed on an
​    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
​    KIND, either express or implied.  See the License for the
​    specific language governing permissions and limitations
​    under the License.

-->

# 气象统计

## ACC

### 函数简介

本函数用于计算两列数值型数据的距平相关系数。

**函数名：** ACC

**输入序列：** 仅支持三个输入序列，类型均为 INT32 / INT64 / FLOAT / DOUBLE。第一列是预测序列；第二列是验证序列；第三列是参照序列。

**输出序列：** 输出单个序列，类型为 DOUBLE。序列仅包含一个时间戳为最后输入时间戳、值为距平相关系数的数据点。

**提示：**

+ 如果某行数据中包含空值、缺失值或`NaN`，该行数据将会被忽略；
+ 如果数据中所有的行都被忽略，函数将会输出`NaN`。

### 使用示例

输入序列：

```
+-----------------------------+----------------+----------------+----------------+
|                         Time|root.weather.for|root.weather.ver|root.weather.ref|
+-----------------------------+----------------+----------------+----------------+
|2013-01-01T00:00:00.000+08:00|             5.0|             4.0|             4.0|
|2013-02-01T00:00:00.000+08:00|             8.0|             6.0|             7.0|
|2013-03-01T00:00:00.000+08:00|             2.0|             1.0|             2.0|
|2013-04-01T00:00:00.000+08:00|             2.0|             5.0|             3.0|
|2013-05-01T00:00:00.000+08:00|            65.0|            63.0|            63.0|
|2013-06-01T00:00:00.000+08:00|            65.0|            63.0|            63.0|
|2013-07-01T00:00:00.000+08:00|            61.0|            60.0|            57.0|
|2013-08-01T00:00:00.000+08:00|            80.0|            23.0|            65.0|
|2013-09-01T00:00:00.000+08:00|           100.0|           105.0|           113.0|
|2013-10-01T00:00:00.000+08:00|            15.0|             3.0|            12.0|
|2013-11-01T00:00:00.000+08:00|             6.0|             4.0|            10.0|
|2013-12-01T00:00:00.000+08:00|            15.0|            15.0|            12.0|
+-----------------------------+----------------+----------------+----------------+
```

用于查询的 SQL 语句：

```sql
select acc(for,ver,ref) from root.test.weather
```

输出序列：

```
+-----------------------------+---------------------------------------------------------+
|                         Time|acc(root.weather.for, root.weather.ver, root.weather.ref)|
+-----------------------------+---------------------------------------------------------+
|2013-12-01T00:00:00.000+08:00|                                      -0.5196317180485549|
+-----------------------------+---------------------------------------------------------+
```


## Departure

### 函数简介

本函数用于计算原序列的距平。

**函数名：** Depature

**输入序列：** 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE.

**输出序列：** 单个输出序列，类型为 DOUBLE.

**参数：**

+ `aggr`: 计算的粒度，输入 "m" 以月为粒度，输入 "d" 以日为粒度。

**输出序列：** 输出单个序列，类型为 DOUBLE。

### 使用示例


输入序列：

```
+-----------------------------+--------------------------+
|                         Time|root.weather.precipitation|
+-----------------------------+--------------------------+
|2013-01-01T00:00:00.000+08:00|                         4|
|2013-02-01T00:00:00.000+08:00|                         6|
|2013-03-01T00:00:00.000+08:00|                         1|
|2013-04-01T00:00:00.000+08:00|                         5|
|2013-05-01T00:00:00.000+08:00|                        27|
|2013-06-01T00:00:00.000+08:00|                        63|
|2013-07-01T00:00:00.000+08:00|                        60|
|2013-08-01T00:00:00.000+08:00|                        23|
|2013-09-01T00:00:00.000+08:00|                       105|
|2013-10-01T00:00:00.000+08:00|                         3|
|2013-11-01T00:00:00.000+08:00|                         4|
|2013-12-01T00:00:00.000+08:00|                        15|
|2014-01-01T00:00:00.000+08:00|                        10|
|2014-02-01T00:00:00.000+08:00|                        13|
|2014-03-01T00:00:00.000+08:00|                         9|
|2014-04-01T00:00:00.000+08:00|                         9|
|2014-05-01T00:00:00.000+08:00|                        26|
|2014-06-01T00:00:00.000+08:00|                        57|
|2014-07-01T00:00:00.000+08:00|                        64|
|2014-08-01T00:00:00.000+08:00|                        16|
|2014-09-01T00:00:00.000+08:00|                       109|
|2014-10-01T00:00:00.000+08:00|                         3|
|2014-11-01T00:00:00.000+08:00|                        11|
|2014-12-01T00:00:00.000+08:00|                        18|
|2015-01-01T00:00:00.000+08:00|                        13|
|2015-02-01T00:00:00.000+08:00|                         0|
|2015-03-01T00:00:00.000+08:00|                         0|
|2015-04-01T00:00:00.000+08:00|                         9|
|2015-05-01T00:00:00.000+08:00|                        19|
|2015-06-01T00:00:00.000+08:00|                        63|
|2015-07-01T00:00:00.000+08:00|                        65|
|2015-08-01T00:00:00.000+08:00|                        29|
|2015-09-01T00:00:00.000+08:00|                        95|
|2015-10-01T00:00:00.000+08:00|                         0|
|2015-11-01T00:00:00.000+08:00|                         9|
|2015-12-01T00:00:00.000+08:00|                        25|
|2016-01-01T00:00:00.000+08:00|                         0|
|2016-02-01T00:00:00.000+08:00|                         0|
|2016-03-01T00:00:00.000+08:00|                         8|
|2016-04-01T00:00:00.000+08:00|                         9|
|2016-05-01T00:00:00.000+08:00|                        21|
|2016-06-01T00:00:00.000+08:00|                        73|
|2016-07-01T00:00:00.000+08:00|                        53|
|2016-08-01T00:00:00.000+08:00|                        30|
|2016-09-01T00:00:00.000+08:00|                       107|
|2016-10-01T00:00:00.000+08:00|                         0|
|2016-11-01T00:00:00.000+08:00|                        11|
|2016-12-01T00:00:00.000+08:00|                         8|
|2017-01-01T00:00:00.000+08:00|                        13|
|2017-02-01T00:00:00.000+08:00|                         8|
|2017-03-01T00:00:00.000+08:00|                         0|
|2017-04-01T00:00:00.000+08:00|                         9|
|2017-05-01T00:00:00.000+08:00|                        32|
|2017-06-01T00:00:00.000+08:00|                        64|
|2017-07-01T00:00:00.000+08:00|                        52|
|2017-08-01T00:00:00.000+08:00|                        29|
|2017-09-01T00:00:00.000+08:00|                       115|
|2017-10-01T00:00:00.000+08:00|                         3|
|2017-11-01T00:00:00.000+08:00|                         0|
|2017-12-01T00:00:00.000+08:00|                        21|
+-----------------------------+--------------------------+
```

用于查询的 SQL 语句：

```sql
select departure(precipitation,'aggr'='m') from root.weather
```

输出序列：

```
+-----------------------------+-------------------------------------------------+
|                         Time|departure(root.weather.precipitation, "aggr"="m")|
+-----------------------------+-------------------------------------------------+
|2013-01-01T00:00:00.000+08:00|                                             -4.0|
|2013-02-01T00:00:00.000+08:00|                               0.5999999999999996|
|2013-03-01T00:00:00.000+08:00|                                             -2.6|
|2013-04-01T00:00:00.000+08:00|                              -3.1999999999999993|
|2013-05-01T00:00:00.000+08:00|                                              2.0|
|2013-06-01T00:00:00.000+08:00|                                             -1.0|
|2013-07-01T00:00:00.000+08:00|                               1.2000000000000028|
|2013-08-01T00:00:00.000+08:00|                              -2.3999999999999986|
|2013-09-01T00:00:00.000+08:00|                              -1.2000000000000028|
|2013-10-01T00:00:00.000+08:00|                                              1.2|
|2013-11-01T00:00:00.000+08:00|                                             -3.0|
|2013-12-01T00:00:00.000+08:00|                              -2.3999999999999986|
|2014-01-01T00:00:00.000+08:00|                                              2.0|
|2014-02-01T00:00:00.000+08:00|                                              7.6|
|2014-03-01T00:00:00.000+08:00|                                              5.4|
|2014-04-01T00:00:00.000+08:00|                               0.8000000000000007|
|2014-05-01T00:00:00.000+08:00|                                              1.0|
|2014-06-01T00:00:00.000+08:00|                                             -7.0|
|2014-07-01T00:00:00.000+08:00|                                5.200000000000003|
|2014-08-01T00:00:00.000+08:00|                               -9.399999999999999|
|2014-09-01T00:00:00.000+08:00|                                2.799999999999997|
|2014-10-01T00:00:00.000+08:00|                                              1.2|
|2014-11-01T00:00:00.000+08:00|                                              4.0|
|2014-12-01T00:00:00.000+08:00|                               0.6000000000000014|
|2015-01-01T00:00:00.000+08:00|                                              5.0|
|2015-02-01T00:00:00.000+08:00|                                             -5.4|
|2015-03-01T00:00:00.000+08:00|                                             -3.6|
|2015-04-01T00:00:00.000+08:00|                               0.8000000000000007|
|2015-05-01T00:00:00.000+08:00|                                             -6.0|
|2015-06-01T00:00:00.000+08:00|                                             -1.0|
|2015-07-01T00:00:00.000+08:00|                                6.200000000000003|
|2015-08-01T00:00:00.000+08:00|                               3.6000000000000014|
|2015-09-01T00:00:00.000+08:00|                              -11.200000000000003|
|2015-10-01T00:00:00.000+08:00|                                             -1.8|
|2015-11-01T00:00:00.000+08:00|                                              2.0|
|2015-12-01T00:00:00.000+08:00|                                7.600000000000001|
|2016-01-01T00:00:00.000+08:00|                                             -8.0|
|2016-02-01T00:00:00.000+08:00|                                             -5.4|
|2016-03-01T00:00:00.000+08:00|                                              4.4|
|2016-04-01T00:00:00.000+08:00|                               0.8000000000000007|
|2016-05-01T00:00:00.000+08:00|                                             -4.0|
|2016-06-01T00:00:00.000+08:00|                                              9.0|
|2016-07-01T00:00:00.000+08:00|                               -5.799999999999997|
|2016-08-01T00:00:00.000+08:00|                                4.600000000000001|
|2016-09-01T00:00:00.000+08:00|                               0.7999999999999972|
|2016-10-01T00:00:00.000+08:00|                                             -1.8|
|2016-11-01T00:00:00.000+08:00|                                              4.0|
|2016-12-01T00:00:00.000+08:00|                               -9.399999999999999|
|2017-01-01T00:00:00.000+08:00|                                              5.0|
|2017-02-01T00:00:00.000+08:00|                               2.5999999999999996|
|2017-03-01T00:00:00.000+08:00|                                             -3.6|
|2017-04-01T00:00:00.000+08:00|                               0.8000000000000007|
|2017-05-01T00:00:00.000+08:00|                                              7.0|
|2017-06-01T00:00:00.000+08:00|                                              0.0|
|2017-07-01T00:00:00.000+08:00|                               -6.799999999999997|
|2017-08-01T00:00:00.000+08:00|                               3.6000000000000014|
|2017-09-01T00:00:00.000+08:00|                                8.799999999999997|
|2017-10-01T00:00:00.000+08:00|                                              1.2|
|2017-11-01T00:00:00.000+08:00|                                             -7.0|
|2017-12-01T00:00:00.000+08:00|                               3.6000000000000014|
+-----------------------------+-------------------------------------------------+
```

## HistoryAvg

### 函数简介

本函数用于计算历史同期的均值。

**函数名：** HistoryAvg

**输入序列：** 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE.

**输出序列：** 单个输出序列，类型为 DOUBLE.

**参数：**

+ `aggr`: 计算的粒度，输入 "m" 以月为粒度，输入 "d" 以日为粒度。

**输出序列：** 输出单个序列，类型为 DOUBLE。

### 使用示例


输入序列：

```
+-----------------------------+--------------------------+
|                         Time|root.weather.precipitation|
+-----------------------------+--------------------------+
|2013-01-01T00:00:00.000+08:00|                         4|
|2013-02-01T00:00:00.000+08:00|                         6|
|2013-03-01T00:00:00.000+08:00|                         1|
|2013-04-01T00:00:00.000+08:00|                         5|
|2013-05-01T00:00:00.000+08:00|                        27|
|2013-06-01T00:00:00.000+08:00|                        63|
|2013-07-01T00:00:00.000+08:00|                        60|
|2013-08-01T00:00:00.000+08:00|                        23|
|2013-09-01T00:00:00.000+08:00|                       105|
|2013-10-01T00:00:00.000+08:00|                         3|
|2013-11-01T00:00:00.000+08:00|                         4|
|2013-12-01T00:00:00.000+08:00|                        15|
|2014-01-01T00:00:00.000+08:00|                        10|
|2014-02-01T00:00:00.000+08:00|                        13|
|2014-03-01T00:00:00.000+08:00|                         9|
|2014-04-01T00:00:00.000+08:00|                         9|
|2014-05-01T00:00:00.000+08:00|                        26|
|2014-06-01T00:00:00.000+08:00|                        57|
|2014-07-01T00:00:00.000+08:00|                        64|
|2014-08-01T00:00:00.000+08:00|                        16|
|2014-09-01T00:00:00.000+08:00|                       109|
|2014-10-01T00:00:00.000+08:00|                         3|
|2014-11-01T00:00:00.000+08:00|                        11|
|2014-12-01T00:00:00.000+08:00|                        18|
|2015-01-01T00:00:00.000+08:00|                        13|
|2015-02-01T00:00:00.000+08:00|                         0|
|2015-03-01T00:00:00.000+08:00|                         0|
|2015-04-01T00:00:00.000+08:00|                         9|
|2015-05-01T00:00:00.000+08:00|                        19|
|2015-06-01T00:00:00.000+08:00|                        63|
|2015-07-01T00:00:00.000+08:00|                        65|
|2015-08-01T00:00:00.000+08:00|                        29|
|2015-09-01T00:00:00.000+08:00|                        95|
|2015-10-01T00:00:00.000+08:00|                         0|
|2015-11-01T00:00:00.000+08:00|                         9|
|2015-12-01T00:00:00.000+08:00|                        25|
|2016-01-01T00:00:00.000+08:00|                         0|
|2016-02-01T00:00:00.000+08:00|                         0|
|2016-03-01T00:00:00.000+08:00|                         8|
|2016-04-01T00:00:00.000+08:00|                         9|
|2016-05-01T00:00:00.000+08:00|                        21|
|2016-06-01T00:00:00.000+08:00|                        73|
|2016-07-01T00:00:00.000+08:00|                        53|
|2016-08-01T00:00:00.000+08:00|                        30|
|2016-09-01T00:00:00.000+08:00|                       107|
|2016-10-01T00:00:00.000+08:00|                         0|
|2016-11-01T00:00:00.000+08:00|                        11|
|2016-12-01T00:00:00.000+08:00|                         8|
|2017-01-01T00:00:00.000+08:00|                        13|
|2017-02-01T00:00:00.000+08:00|                         8|
|2017-03-01T00:00:00.000+08:00|                         0|
|2017-04-01T00:00:00.000+08:00|                         9|
|2017-05-01T00:00:00.000+08:00|                        32|
|2017-06-01T00:00:00.000+08:00|                        64|
|2017-07-01T00:00:00.000+08:00|                        52|
|2017-08-01T00:00:00.000+08:00|                        29|
|2017-09-01T00:00:00.000+08:00|                       115|
|2017-10-01T00:00:00.000+08:00|                         3|
|2017-11-01T00:00:00.000+08:00|                         0|
|2017-12-01T00:00:00.000+08:00|                        21|
+-----------------------------+--------------------------+
```

用于查询的 SQL 语句：

```sql
select HistoryAvg(precipitation,'aggr'='m') from root.weather limit 12
```

输出序列：

```
+-----------------------------+--------------------------------------------------+
|                         Time|HistoryAvg(root.weather.precipitation, "aggr"="m")|
+-----------------------------+--------------------------------------------------+
|2013-01-01T00:00:00.000+08:00|                                               8.0|
|2013-02-01T00:00:00.000+08:00|                                               5.4|
|2013-03-01T00:00:00.000+08:00|                                               3.6|
|2013-04-01T00:00:00.000+08:00|                                               8.2|
|2013-05-01T00:00:00.000+08:00|                                              25.0|
|2013-06-01T00:00:00.000+08:00|                                              64.0|
|2013-07-01T00:00:00.000+08:00|                                              58.8|
|2013-08-01T00:00:00.000+08:00|                                              25.4|
|2013-09-01T00:00:00.000+08:00|                                             106.2|
|2013-10-01T00:00:00.000+08:00|                                               1.8|
|2013-11-01T00:00:00.000+08:00|                                               7.0|
|2013-12-01T00:00:00.000+08:00|                                              17.4|
+-----------------------------+--------------------------------------------------+
```
## 累积距平

### 函数简介

本函数用于计算原序列的累积距平。

**函数名：** Accumulated Depature

**输入序列：** 仅支持单个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE.

**输出序列：** 单个输出序列，类型为 DOUBLE.

**参数：**

+ `aggr`: 计算的粒度，输入 "m" 以月为粒度，输入 "d" 以日为粒度。
+ `period`: 历史跨度，比如5年表示计算过去5年的历史数据。


## 欧氏距离

### 函数简介

本函数用于计算两个序列之间的欧氏距离。

**函数名：** EuclidDis

**输入序列：** 仅支持两个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE.

**输出序列：** 输出单个序列，类型为 DOUBLE，序列仅包含一个时间戳为 0、值为计算结果的数据点。
